<?xml version="1.0" encoding="utf-8"?>

<?xml-model href="rfc7991bis.rnc"?>  <!-- Required for schema validation and schema-aware editing -->
<?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
<!-- This third-party XSLT can be enabled for direct transformations in XML processors, including most browsers -->

<!DOCTYPE rfc [
  <!ENTITY nbsp    "&#160;">
  <!ENTITY zwsp   "&#8203;">
  <!ENTITY nbhy   "&#8209;">
  <!ENTITY wj     "&#8288;">
]>
<!-- If further character entities are required then they should be added to the DOCTYPE above.
     Use of an external entity file is not recommended. -->
<rfc
  xmlns:xi="http://www.w3.org/2001/XInclude"
  category="info"
  docName="draft-kdyxy-rats-tdx-eat-profile-00"
  ipr="trust200902"
  obsoletes=""
  updates=""
  submissionType="independent"
  xml:lang="en"
  version="3">
  <front>
    <title abbrev="TDX EAT profile">EAT profile for Intel® Trust Domain Extensions (TDX) attestation result</title>
    <seriesInfo name="Internet-Draft" value="draft-kdyxy-rats-tdx-eat-profile-00"/>
    <author fullname="Greg Kostal" initials="G." surname="Kostal">
      <organization>Microsoft</organization>
      <address>
        <email>gkostal@microsoft.com</email>  
      </address>
    </author>
    <author fullname="Sindhuri Dittakavi" initials="S." surname="Dittakavi">
      <organization>Microsoft</organization>
      <address>
        <email>sindhuri.dittakavi@microsoft.com</email>  
      </address>
    </author>
    <author fullname="Raghuram Yeluri" initials="R." surname="Yeluri">
      <organization>Intel</organization>
      <address>
        <email>raghuram.yeluri@intel.com</email>  
      </address>
    </author>
    <author fullname="Haidong Xia" initials="H." surname="Xia">
      <organization>Intel</organization>
      <address>
        <email>haidong.xia@intel.com</email>  
      </address>
    </author>
     <author fullname="Jerry Yu" initials="J." surname="Yu">
      <organization>Intel</organization>
      <address>
        <email>jerry.yu@intel.com</email>  
      </address>
    </author>
    <date year="2023"/>
    <area>Security</area>
    <workgroup>Remote ATtestation ProcedureS</workgroup>
    <keyword>Internet-Draft</keyword>
    <abstract>
      <t>Intel® Trust Domain Extensions (TDX) introduces architectural elements designed for the deployment of hardware-isolated virtual machines (VMs) known as trust domains (TDs). TDX is designed to provide a more secure and isolated environment for running sensitive workloads or applications. The Entity Attestation Token (EAT) profile outlines claims for an Intel TDX attestation result. These claims enable a relying party to establish trust with the environment. </t>
    </abstract>
  </front>
  <middle>   
    <section>
      <name>Introduction</name>
      <t>The profile outlines the claims for an Intel® Trust Domain Extensions <xref target="TDX"/> attestation result, 
        generated as an Entity Attestation Token <xref target="EAT"/> in a signed JSON Web Token <xref target="JWT"/> 
        format using JOSE header. It doesn't contain nested tokens or a detached EAT bundle. The profile allows signing 
        of the JWT token using RSA cryptographic algorithm. To facilitate verification of the signed JWT tokens, the 
        verifier can expose the trusted token signing certificates using an OpenID metadata endpoint. In accordance 
        with the standards outlined in the JSON Web Signature <xref target="JWS"/> specification, the receiver of the 
        profile can use the certificate with key ID (kid) matching the kid parameter in the attestation token header 
        for performing signature verification.</t>
    </section>
    <section>
        <name>Requirements Language</name>
        <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL",
          "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT
          RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be
          interpreted as described in BCP 14 <xref target="RFC2119"/>
          <xref target="RFC8174"/> when, and only when, they appear in
          all capitals, as shown here.</t>
    </section>
     <section>
        <name>TDX profile claims</name>
    <section>
        <name>JWT claims</name>
        <t>The complete definitions of the following claims are available in the IETF [JWT] specification. </t>
         <dl newline="true">
          <dt>iat</dt>
          <dd>The "iat" (issued at) claim identifies the time at which the JWT was issued.</dd>
          <dt>exp</dt>
          <dd>The "exp" (expiration time) claim identifies the expiration time on or after which the JWT MUST NOT be accepted for processing. </dd>
          <dt>iss</dt>
          <dd>The "iss" (issuer) claim identifies the principal that issued the JWT.</dd>
          <dt>jti</dt>
          <dd>The "jti" (JWT ID) claim provides a unique identifier for the JWT.</dd>
          <dt>nbf</dt>
          <dd>The "nbf" (not before) claim identifies the time before which the JWT MUST NOT be accepted for processing. </dd>
         </dl>
     </section>
    <section>
        <name>EAT claims</name>   
       <t>The complete definitions of the following claims are available in the [EAT] specification.</t>
         <dl newline="true">
          <dt>eat_profile</dt>
          <dd>The "eat_profile" claim identifies an EAT profile by either a URL or an OID.</dd>
          <dt>dbgstat</dt>
          <dd>The "dbgstat" claim applies to entity-wide or submodule-wide debug facilities of the entity like <xref target="JTAG"/> and diagnostic hardware built into chips.</dd>
          <dt>intuse</dt>
          <dd>The "intuse" claim provides an indication to an EAT consumer about the intended usage of the token. </dd>
          <dt>eat_nonce</dt>
          <dd>An EAT nonce is either a byte or text string or an array of byte or text strings.  The array option supports multistage EAT verification and consumption.</dd>
         </dl>
    </section>
    <section>
        <name>TDX claims</name>
       <t>The complete definitions of the claims are available in the section A.3.2 TD Quote Body of Intel® TDX DCAP Quoting Library API <xref target="TDX-DCAP-Quoting-Library"/>.</t>
          <dl newline="true">
          <dt>tdx_mrsignerseam</dt>
          <dd>The 96 character hexadecimal string represents a byte array of length 48 containing the measurement of the TDX module signer, provided it is valid.</dd>
          <dt>tdx_mrseam</dt>
          <dd>The 96 character hexadecimal string represents a byte array of length 48 containing the measurement of the Intel TDX module.</dd>
          <dt>tdx_mrtd</dt>
          <dd>The 96 character hexadecimal string represents a byte array of length 48 containing the measurement of the initial contents of the TDX.</dd>
          <dt>tdx_rtmr0</dt>
          <dd>The 96 character hexadecimal string represents a byte array of length 48 containing the runtime extendable measurement register.</dd>
          <dt>tdx_rtmr1</dt>
          <dd>The 96 character hexadecimal string represents a byte array of length 48 containing the runtime extendable measurement register.</dd>
          <dt>tdx_rtmr2</dt>
          <dd>The 96 character hexadecimal string represents a byte array of length 48 containing the runtime extendable measurement register.</dd>
          <dt>tdx_rtmr3</dt>
          <dd>The 96 character hexadecimal string represents a byte array of length 48 containing the runtime extendable measurement register.</dd>
          <dt>tdx_mrconfigid</dt>
          <dd>The 96 character hexadecimal string represents a byte array of length 48 containing the software-defined ID for non-owner-defined configuration of the TDX, e.g., runtime or Operating System (OS) configuration. </dd>
          <dt>tdx_mrowner</dt>
          <dd>The 96 character hexadecimal string represents a byte array of length 48 containing the software-defined ID for the TDX's owner.</dd>
          <dt>tdx_mrownerconfig</dt>
          <dd>The 96 character hexadecimal string represents a byte array of length 48 containing the software-defined ID for owner-defined configuration of the TDX, e.g., specific to the workload rather than the runtime or OS.</dd>
          <dt>tdx_report_data</dt>
          <dd>The 128 character hexadecimal string represents a byte array of length 64. In this context, the TDX has the flexibility to include 64 bytes of custom data in a TDX Report. For instance, this space can be used to hold a nonce, a public key, or a hash of a larger block of data.</dd>
          <dt>tdx_seam_attributes</dt>
          <dd>The 16 character hexadecimal string represents a byte array of length 8 containing additional configuration of the TDX module.</dd>
          <dt>tdx_tee_tcb_svn</dt>
          <dd>The 32 character hexadecimal string represents a byte array of length 16 describing the Trusted Computing Base (TCB) Security Version Numbers (SVNs) of TDX.</dd>
          <dt>tdx_xfam</dt>
          <dd>The 16 character hexadecimal string represents a byte array of length 8 containing a mask of CPU extended features that the TDX is allowed to use.</dd>
          <dt>tdx_seamsvn</dt>
          <dd>The number represents the Intel TDX module SVN. The complete definition of the claim is available in section 3.1 SEAM_SIGSTRUCT: INTEL® TDX MODULE SIGNATURE STRUCTURE of Intel® TDX Loader Interface Specification <xref target="TDX-Loader-Interface"/></dd>
          <dt>tdx_td_attributes</dt>
          <dd>The 16 character hexadecimal string represents a byte array of length 8. These are the attributes associated with the Trust Domain (TD).  The complete definitions of the claims mentioned below are available in A.3.4. TD Attributes of <xref target="TDX-DCAP-Quoting-Library"/></dd>
          <dt>tdx_td_attributes_debug</dt>
          <dd>The boolean value indicates whether the TD runs in TD debug mode (set to 1) or not (set to 0). In TD debug mode, the CPU state and private memory are accessible by the host VMM.</dd>
          <dt>tdx_td_attributes_key_locker</dt>
          <dd>The boolean value indicates whether the TD is allowed to use Key Locker.</dd>
         <dt>tdx_td_attributes_perfmon</dt>
          <dd>The boolean value indicates whether the TD is allowed to use Perfmon and PERF_METRICS capabilities.</dd>
         <dt>tdx_td_attributes_protection_keys</dt>
          <dd>The boolean value incidcates whether the TD is allowed to use Supervisor Protection Keys.</dd>
         <dt>tdx_td_attributes_septve_disable</dt>
          <dd>The boolean value that determines whether to disable EPT violation conversion to #VE on TD access of PENDING pages.</dd>
          </dl>
     </section>
    <section>
        <name>Attester claims</name>
       <dl newline="true">
          <dt>attester_advisory_ids</dt>
          <dd>Array of Advisory IDs referring to Intel security advisories that provide insight into the reason(s) for the value of tcbStatus of the platform TCB level being evaluated. See advisoryIDs in Intel® Trusted Services API Management Developer Portal <xref target="TDX-API-Management-Portal"/>.</dd>
          <dt>attester_tcb_status</dt>
          <dd>The string value represents the TCB level status of the platform being evaluated. See tcbStatus in <xref target="TDX-API-Management-Portal"/>.</dd>
       </dl>
    </section>
    </section>
    <section anchor="IANA">
      <name>IANA Considerations</name>
      <t>This memo includes no request to IANA.</t>
    </section>
    <section anchor="Security">
      <name>Security Considerations</name>
      <t>This specification re-uses the EAT and JWT specifications.  Hence, the security and privacy considerations of those specifications apply here as well.</t>
    </section>
  </middle>
  <back>
    <references>
      <name>References</name>
      <references>
        <name>Normative References</name>
         <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8174.xml"/>
        <reference anchor="EAT" target="https://datatracker.ietf.org/doc/html/draft-ietf-rats-eat-21">
          <front>
            <title>The Entity Attestation Token (EAT)</title>
            <author fullname="Laurence Lundblade" initials="L." surname="Lundblade">
              <organization>Security Theory LLC</organization>
            </author>
            <author fullname="Giridhar Mandyam" initials="G." surname="Mandyam">
              <organization>Qualcomm Technologies Inc.</organization>
            </author>
            <author fullname="Jeremy O'Donoghue" initials="J." surname="O'Donoghue">
              <organization>Qualcomm Technologies Inc.</organization>
            </author>
            <author fullname="Carl Wallace" initials="C." surname="Wallace">
              <organization>Red Hound Software, Inc.</organization>
            </author>
            <date day="30" month="June" year="2023"/>
            </front>
        </reference>
         <reference anchor="JWT" target="https://datatracker.ietf.org/doc/html/rfc7519">
          <front>
            <title> JSON Web Token (JWT)</title>
            <author fullname="Michael B. Jones" initials="M." surname="Jones">
              <organization>Security Theory LLC</organization>
            </author>
            <author fullname="John Bradley" initials="J." surname="Bradley">
              <organization>Qualcomm Technologies Inc.</organization>
            </author>
            <author fullname="Nat Sakimura" initials="N." surname="Sakimura">
              <organization>Qualcomm Technologies Inc.</organization>
            </author>
            <date month="May" year="2015"/>
            </front>
        </reference>
         <reference anchor="JWS" target="https://datatracker.ietf.org/doc/html/rfc7515">
          <front>
            <title>JSON Web Signature (JWS)</title>
           <author fullname="Michael B. Jones" initials="M." surname="Jones">
              <organization>Security Theory LLC</organization>
            </author>
            <author fullname="John Bradley" initials="J." surname="Bradley">
              <organization>Qualcomm Technologies Inc.</organization>
            </author>
            <author fullname="Nat Sakimura" initials="N." surname="Sakimura">
              <organization>Qualcomm Technologies Inc.</organization>
            </author>
            <date month="May" year="2015"/>
            </front>
        </reference>
      </references>
      <references>
        <name>Informative References</name>
        <reference anchor="JTAG" target="https://ieeexplore.ieee.org/document/5412866">
        <front>
          <title>IEEE Standard for Reduced-Pin and Enhanced-Functionality Test Access Port and Boundary-Scan Architecture</title>
          <author >
            <organization></organization>
          </author>
          <date year="2010" month="February"/>
        </front>
      </reference>
        <reference anchor="TDX" target="https://cdrdv2.intel.com/v1/dl/getContent/690419">
          <front>
            <title>Intel® Trust Domain Extensions</title>
            <author>
              <organization>Intel</organization>
            </author>
            <date month="Feb" year="2023"/>
          </front>
        </reference>
        <reference anchor="TDX-API-Management-Portal" target="https://api.portal.trustedservices.intel.com/documentation">
          <front>
            <title>Intel® Trust Domain Extensions</title>
            <author>
              <organization>Intel</organization>
            </author>
            <date month="Feb" year="2023"/>
          </front>
        </reference>
         <reference anchor="TDX-DCAP-Quoting-Library" target="https://download.01.org/intel-sgx/latest/dcap-latest/linux/docs/Intel_TDX_DCAP_Quoting_Library_API.pdf">
          <front>
            <title>Intel® Trust Domain Extensions Data Center Attestation Primitives (Intel® TDX DCAP): Quote Generation Library and Quote Verification Library</title>
            <author>
              <organization>Intel</organization>
            </author>
            <date month="Aug" year="2023"/>
          </front>
        </reference>
         <reference anchor="TDX-Loader-Interface" target="https://cdrdv2.intel.com/v1/dl/getContent/733584">
          <front>
            <title>Intel® Trust Domain Extensions - SEAM Loader (SEAMLDR) Interface Specification</title>
            <author>
              <organization>Intel</organization>
            </author>
            <date month="Mar" year="2022"/>
          </front>
        </reference>
        <reference anchor="Trust-Authority" target="https://www.intel.com/content/www/us/en/security/trust-authority.html">
          <front>
            <title>Intel® Trust Authority</title>
            <author>
              <organization>Intel</organization>
            </author>
            <date month="Oct" year="2023"/>
          </front>
        </reference>
        <reference anchor="Trust-Authority-EAT-Profile" target="https://portal.trustauthority.intel.com/eat_profile">
          <front>
            <title>EAT profile of Intel® Trust Authority</title>
            <author>
              <organization>Intel</organization>
            </author>
            <date month="Oct" year="2023"/>
          </front>
        </reference>
      </references>
    </references>
    <section>
      <name>Appendix</name>
       <t>The below example illustrates an attestation token generated by Intel® Trust Authority <xref target="Trust-Authority"/> during TDX validation, which reuses the previously mentioned claims. The attestation can be requested from a client within the confidential computing environment. <xref target="Trust-Authority-EAT-Profile"/> includes definitions of the following claims</t>
        <artwork><![CDATA[
      {
  "alg": "PS384",
  "jku": "
https://portal.trustauthority.intel.com/certs"
,
  "kid": "1881f519948621f7aeb538a8a5896bb3fb7c271c3522081c5dd7af1a683bac
          f6d90a63e82ade85c00321781591dfdf3d",
  "typ": "JWT"
}.{
  "tdx_tee_tcb_svn": "02010600000000000000000000000000",
  "tdx_mrseam": "360304d34a16aace0a18e09ad2d07d2b9fd3c174378e5bf10838807
          9827f89ff62acc5f8c473dd40706324834e202946",
  "tdx_mrsignerseam": "000000000000000000000000000000000000000000000000
          000000000000000000000000000000000000000000000000",
  "tdx_seam_attributes": "0000000000000000",
  "tdx_td_attributes": "0000000000000000",
  "tdx_xfam": "e718060000000000",
  "tdx_mrtd": "75f3acc2e1dfc3acf404d7eaa69a2eefcd0475a0dd6516ef5ba3cb8
          3399c61b4aa1c638e3622bb650a514bfc6e858886",
  "tdx_mrconfigid": "0000000000000000000000000000000000000000000000000
          00000000000000000000000000000000000000000000000",
  "tdx_mrowner": "0000000000000000000000000000000000000000000000000000
          00000000000000000000000000000000000000000000",
  "tdx_mrownerconfig": "0000000000000000000000000000000000000000000000
          00000000000000000000000000000000000000000000000000",
  "tdx_rtmr0": "000000000000000000000000000000000000000000000000000000
          000000000000000000000000000000000000000000",
  "tdx_rtmr1": "000000000000000000000000000000000000000000000000000000
          000000000000000000000000000000000000000000",
  "tdx_rtmr2": "000000000000000000000000000000000000000000000000000000
          000000000000000000000000000000000000000000",
  "tdx_rtmr3": "000000000000000000000000000000000000000000000000000000
          000000000000000000000000000000000000000000",
  "tdx_report_data": "7e3b88c09ed42bad38c146f542fbee862411878fa33a3fdf
          bffd2ad549db279200000000000000000000000000000000000000000000
          00000000000000000000",
  "tdx_seamsvn": 2,
  "tdx_td_attributes_debug": false,
  "tdx_td_attributes_septve_disable": false,
  "tdx_td_attributes_protection_keys": false,
  "tdx_td_attributes_key_locker": false,
  "tdx_td_attributes_perfmon": false,
  "tdx_is_debuggable": false,
  "tdx_collateral": {
    "qeidcerthash": "b2ca71b8e849d5e799451b4bfe43159a0ee548032cecb2c0e4
          79bf6ee3f39fd1",
    "qeidcrlhash": "f454dc1b9bd4ce36c04241e2c8c37a2ae26b077f2c66b919843
          365318a59332c",
    "qeidhash": "665b5e4a8c34c24935448629894302b0bc8a054f25e43333021dd8
          c93e9211be",
    "quotehash": "be3de7edd324a21cb73f8ba3d8ea5bd704bd27809dd6f0c8de152
          5511845389c",
    "tcbinfocerthash": "b2ca71b8e849d5e799451b4bfe43159a0ee548032cecb2c
          0e479bf6ee3f39fd1",
    "tcbinfocrlhash": "f454dc1b9bd4ce36c04241e2c8c37a2ae26b077f2c66b919
          843365318a59332c",
    "tcbinfohash": "7c2b91b9aaaf0a9823f17bb6b31403fffee7fe0b658b41d9e80
          2c6de8569096d"
  },
  "attester_runtime_data": {
    "keys": [
      {
        "e": "AQAB",
        "key_ops": [
          "sign"
        ],
        "kid": "HCLAkPub",
        "kty": "RSA",
        "n": "re9HMAABLCLoWzLjUztrLCBCCf5V1CarfWtsufM4hFS-E-SQuuEZemzwo
          YrW5QXTVfJv32wdSrWpwnxNjmjz6ThWeAZB9L-OE9iGgvYItR3_DCA2PYGDIf
          At_dzSiyJhA4vnJHKXQLxcxW1CncrNDTkCKY4dPoheg9a4HN_smIds9U6My4e
          5tKe0dB-b2FjZOGD9ZlQd30GxVhjc4EZNZfhL__1P8kFDOe2mn3I1bY2H65ry
          KxykUqEy90hhWSipVol7CSjhgIsu--owm1UE4PvsJ5SwGd4paWrhGoSw2XHny
          PNoGIEsN07IY3RasHH7NyeWW9c_4z0-52HyTx9EGw"
      },
      {
        "e": "AQAB",
        "key_ops": [
          "encrypt"
        ],
        "kid": "HCLEkPub",
        "kty": "RSA",
        "n": "4bgbkQAAjeNvziwf0DEUuXhx6mZiaoToilKLN2KwIpEC9pt4fiJ7A6VjN
          1EPugLruIFWPFFnXXqwfsbPWnnAlaOVxfYb-Wjmsex7WHM2XvdRewHdXEffeQ
          3cINEzdY_EVXf-XN0dYhmP-W4ghbAt6I-mORODz8t5E7apYyHya4cPYFqFdOn
          p2NvotnkrTjz9gZqXj6FAu6vYi9EZRWgt4X_rv5j8ka7FsIPs1B9w4BW_3a4Y
          yzCgY21jodzafjr4ioG9EbSnDCE99I2PcIkvFK2OD-l3WWlZQ5XA6DKvfh0SM
          ZTOA6JnhYM7y6h14k9GR7x77Vy0xXGLMHYRxpf1dw"
      }
    ],
    "user-data": "00000000000000000000000000000000000000000000000000000
          0000000000000000000000000000000000000000000000000000000000000
          00000000000000",
    "vm-configuration": {
      "console-enabled": true,
      "root-cert-thumbprint": "6nZZnYaJc4KqUZ_yvA-mucFdYNouvlPnITnNMXsH
          l-0",
      "secure-boot": false,
      "tpm-enabled": true,
      "tpm-persisted": false,
      "vmUniqueId": "983742F2-8467-44F0-8C7B-789BE2FFCD3C"
    }
  },
  "policy_ids_matched": [
    {
      "id": "094f9b2d-5477-4607-8a5f-bd33388c60c7",
      "version": "v4"
    }
  ],
  "policy_defined_claims": {},
  "attester_tcb_status": "OK",1
  "attester_type": "TDX",
  "verifier_instance_ids": [
    "64edd3d8-be70-4d03-9cb5-e5575107c87d",
    "56b8f9df-f6c5-4302-8142-321985f269c4",
    "5f6d8e1e-288a-409e-ad3f-3670f00a426c",
    "c82f8048-ea8b-4407-9365-3990bb646e3e"
  ],
  "dbgstat": "disabled",
  "eat_profile": "
https://portal.trustauthority.intel.com/eat_profile"
,
  "intuse": "generic",
  "ver": "1.0.0",
  "exp": 1696973571,
  "jti": "ac2ca0de-e271-4878-a56f-59e5e6b8c328",
  "iat": 1696973271,
  "iss": "Intel Trust Authority",
  "nbf": 1696973271
}
     ]]></artwork>
    </section>
    <section anchor="Acknowledgements" numbered="false">
      <name>Acknowledgements</name>
      <t>Thanks to Dave Thaler for offering guidance in drafting and publishing the profile.</t>
    </section>
 </back>
</rfc>
